<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jedburgh Jigsaw Competition â€” Question 10 Simulator</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Sora:wght@300;400;600;700&display=swap');
  :root {
    --bg:#0d1117;--surface:#161b22;--surface2:#1e2530;--border:#30363d;
    --accent:#f0a500;--green:#3fb950;--red:#f85149;--blue:#58a6ff;
    --text:#e6edf3;--muted:#8b949e;--radius:8px;
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{background:var(--bg);color:var(--text);font-family:'Sora',sans-serif;font-size:15px;line-height:1.6;}

  /* HEADER */
  .header{background:linear-gradient(135deg,#1a1f2e,#0d1117);border-bottom:1px solid var(--border);padding:20px 40px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;}
  .header-left{display:flex;align-items:center;gap:14px;}
  .jigsaw-icon{font-size:28px;animation:rotate 20s linear infinite;}
  @keyframes rotate{to{transform:rotate(360deg);}}
  .header h1{font-family:'Space Mono',monospace;font-size:16px;color:var(--accent);}
  .header p{font-size:11px;color:var(--muted);margin-top:2px;}
  .score-bar{display:flex;align-items:center;gap:10px;background:var(--surface);border:1px solid var(--border);border-radius:40px;padding:7px 18px;}
  .score-label{font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;}
  .score-value{font-family:'Space Mono',monospace;font-size:18px;font-weight:700;color:var(--accent);min-width:52px;text-align:right;}
  .score-track{width:100px;height:5px;background:var(--border);border-radius:3px;overflow:hidden;}
  .score-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--green));border-radius:3px;transition:width .5s cubic-bezier(.4,0,.2,1);}

  /* LAYOUT */
  .container{max-width:1200px;margin:0 auto;padding:36px 24px 80px;}
  .section-banner{background:linear-gradient(90deg,rgba(240,165,0,.12),transparent);border-left:3px solid var(--accent);padding:10px 18px;margin:44px 0 20px;border-radius:0 var(--radius) var(--radius) 0;}
  .section-banner h2{font-family:'Space Mono',monospace;font-size:13px;color:var(--accent);text-transform:uppercase;letter-spacing:1px;}
  .section-banner p{font-size:12px;color:var(--muted);margin-top:3px;}

  /* CARDS */
  .q-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;margin-bottom:20px;overflow:hidden;transition:border-color .3s;}
  .q-card.answered{border-color:rgba(63,185,80,.35);}
  .q-header{display:flex;align-items:center;padding:14px 18px;background:var(--surface2);border-bottom:1px solid var(--border);cursor:pointer;user-select:none;}
  .q-header:hover{background:#252d3a;}
  .q-tag{font-family:'Space Mono',monospace;font-size:10px;background:rgba(240,165,0,.12);color:var(--accent);border:1px solid rgba(240,165,0,.3);padding:2px 9px;border-radius:20px;margin-right:10px;flex-shrink:0;}
  .q-title{font-size:13px;font-weight:600;flex:1;}
  .q-marks{font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);margin-left:10px;}
  .q-status{font-size:16px;margin-left:8px;width:22px;text-align:center;}
  .q-chevron{color:var(--muted);transition:transform .3s;font-size:11px;margin-left:6px;}
  .q-card.open .q-chevron{transform:rotate(180deg);}
  .q-body{display:none;padding:22px;}
  .q-card.open .q-body{display:block;}

  /* CONTEXT */
  .context{background:rgba(88,166,255,.06);border:1px solid rgba(88,166,255,.18);border-radius:var(--radius);padding:14px 16px;margin-bottom:18px;font-size:13px;color:#cdd9e5;line-height:1.7;}
  .context code{background:rgba(255,255,255,.08);padding:1px 5px;border-radius:3px;font-family:'Space Mono',monospace;font-size:11px;}

  /* CODE */
  .code-block{background:#080c10;border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;font-family:'Space Mono',monospace;font-size:12px;line-height:1.8;color:#e6edf3;margin:10px 0;overflow-x:auto;white-space:pre;}
  .kw{color:#ff7b72;}.str{color:#a5d6ff;}.fn{color:#d2a8ff;}.cmt{color:#6e7681;font-style:italic;}

  /* SIDE BY SIDE */
  .compare-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;}
  @media(max-width:700px){.compare-grid{grid-template-columns:1fr;}}
  .compare-pane{display:flex;flex-direction:column;}
  .pane-label{font-family:'Space Mono',monospace;font-size:10px;text-transform:uppercase;letter-spacing:1px;padding:8px 14px;border-radius:var(--radius) var(--radius) 0 0;display:flex;align-items:center;gap:8px;}
  .pane-label.student{background:#1a1f2e;border:1px solid var(--border);border-bottom:none;color:var(--muted);}
  .pane-label.model{background:#0f1e14;border:1px solid rgba(63,185,80,.3);border-bottom:none;color:var(--green);}
  .pane-dot{width:7px;height:7px;border-radius:50%;}
  textarea.code-editor{width:100%;background:#080c10;border:1px solid var(--border);border-radius:0 0 var(--radius) var(--radius);padding:14px;font-family:'Space Mono',monospace;font-size:12px;line-height:1.8;color:var(--text);resize:vertical;min-height:90px;outline:none;transition:border-color .2s;flex:1;}
  textarea.code-editor:focus{border-color:var(--accent);}
  textarea.text-editor{width:100%;background:#080c10;border:1px solid var(--border);border-radius:0 0 var(--radius) var(--radius);padding:14px;font-family:'Sora',sans-serif;font-size:13px;line-height:1.7;color:var(--text);resize:vertical;min-height:80px;outline:none;transition:border-color .2s;flex:1;}
  textarea.text-editor:focus{border-color:var(--accent);}
  .model-pane{background:#080c10;border:1px solid rgba(63,185,80,.3);border-radius:0 0 var(--radius) var(--radius);padding:14px;font-family:'Space Mono',monospace;font-size:12px;line-height:1.8;color:#7ee787;white-space:pre-wrap;min-height:90px;flex:1;}
  .model-pane.prose{font-family:'Sora',sans-serif;font-size:13px;color:#8ee4a0;line-height:1.7;}

  /* SIM PANEL */
  .sim-panel{background:#080c10;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-top:12px;}
  .sim-header{display:flex;align-items:center;gap:7px;padding:9px 14px;background:#0f1318;border-bottom:1px solid var(--border);}
  .sim-dot{width:9px;height:9px;border-radius:50%;}
  .sim-dot.red{background:#ff5f57;}.sim-dot.yellow{background:#febc2e;}.sim-dot.green{background:#28c840;}
  .sim-title{font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;margin-left:6px;}
  .sim-body{padding:14px;font-family:'Space Mono',monospace;font-size:12px;line-height:1.8;min-height:60px;}
  .sim-table{width:100%;border-collapse:collapse;font-size:12px;font-family:'Space Mono',monospace;}
  .sim-table th{background:var(--surface2);padding:8px 12px;text-align:left;border-bottom:1px solid var(--border);color:var(--accent);font-size:10px;text-transform:uppercase;letter-spacing:.5px;}
  .sim-table td{padding:8px 12px;border-bottom:1px solid rgba(48,54,61,.5);}
  .sim-table tr:last-child td{border-bottom:none;}
  .pts-8{color:var(--accent);font-weight:700;}.pts-5{color:#c2a500;}.pts-3{color:var(--blue);}.pts-1{color:var(--muted);}
  .ok{color:var(--green);}.bad{color:var(--red);}

  /* DB SIM */
  .db-panel{background:#080c10;border:1px solid var(--border);border-radius:var(--radius);padding:18px;margin:14px 0;font-family:'Space Mono',monospace;font-size:12px;}
  .db-connecting{color:var(--accent);animation:pulse 1s ease-in-out infinite;}
  .db-connected{color:var(--green);}.db-failed{color:var(--red);}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
  .db-row{display:flex;gap:10px;margin-top:6px;}
  .db-row span:first-child{color:var(--muted);min-width:80px;}

  /* INPUTS */
  .input-row{display:flex;gap:10px;margin:12px 0;flex-wrap:wrap;}
  .input-group{flex:1;min-width:160px;}
  .input-group label{font-size:11px;color:var(--muted);display:block;margin-bottom:5px;font-family:'Space Mono',monospace;}
  .input-group input{width:100%;background:#080c10;border:1px solid var(--border);border-radius:var(--radius);padding:9px 12px;font-family:'Space Mono',monospace;font-size:12px;color:var(--text);outline:none;transition:border-color .2s;}
  .input-group input:focus{border-color:var(--accent);}
  .input-group input.ok{border-color:var(--green);}.input-group input.bad{border-color:var(--red);}

  /* BUTTONS */
  .btn-row{display:flex;gap:10px;margin-top:16px;flex-wrap:wrap;align-items:center;}
  .btn{padding:9px 18px;border-radius:var(--radius);border:none;font-family:'Space Mono',monospace;font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;letter-spacing:.5px;}
  .btn-submit{background:var(--accent);color:#000;}
  .btn-submit:hover{background:#ffb700;transform:translateY(-1px);}
  .btn-run{background:#0f1e14;color:var(--green);border:1px solid rgba(63,185,80,.35);}
  .btn-run:hover{background:#132318;}
  .btn-reset{background:var(--surface2);color:var(--muted);border:1px solid var(--border);}
  .btn-reset:hover{color:var(--text);border-color:var(--muted);}
  .hint-btn{font-size:11px;color:var(--blue);cursor:pointer;border:none;background:none;padding:0;font-family:'Space Mono',monospace;text-decoration:underline;}

  /* HINT */
  .hint-box{background:rgba(88,166,255,.07);border:1px solid rgba(88,166,255,.2);border-radius:var(--radius);padding:10px 14px;margin-top:8px;font-size:12px;color:#8ab4d4;display:none;}
  .hint-box.show{display:block;}
  .hint-box code{background:rgba(255,255,255,.08);padding:1px 5px;border-radius:3px;font-family:'Space Mono',monospace;font-size:11px;}

  /* MARK BADGE */
  .mark-badge{display:inline-flex;align-items:center;gap:5px;font-family:'Space Mono',monospace;font-size:11px;padding:3px 10px;border-radius:20px;margin-left:auto;}
  .mark-badge.full{background:rgba(63,185,80,.15);color:var(--green);border:1px solid rgba(63,185,80,.3);}
  .mark-badge.partial{background:rgba(240,165,0,.12);color:var(--accent);border:1px solid rgba(240,165,0,.3);}
  .mark-badge.zero{background:rgba(248,81,73,.1);color:var(--red);border:1px solid rgba(248,81,73,.25);}

  /* WIREFRAME */
  .wireframe{border:2px dashed var(--border);border-radius:var(--radius);padding:18px;margin:10px 0 18px;background:#0a0d10;font-size:13px;}
  .wf-label{font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;}
  .wf-box{border:1px solid #3a3a3a;border-radius:4px;padding:16px;background:#141920;}
  .wf-hl{background:rgba(240,165,0,.18);border:1px solid rgba(240,165,0,.35);padding:1px 5px;border-radius:3px;}
  .wf-btn{display:block;width:160px;text-align:center;margin:12px auto 0;padding:7px;border:1px solid #444;border-radius:4px;font-size:12px;color:var(--muted);}

  /* INTRO */
  .intro{background:linear-gradient(135deg,var(--surface),#131920);border:1px solid var(--border);border-radius:12px;padding:26px;margin-bottom:36px;display:flex;gap:20px;}
  .intro-icon{font-size:36px;flex-shrink:0;}
  .intro h2{font-size:18px;font-weight:700;margin-bottom:6px;}
  .intro p{font-size:13px;color:var(--muted);line-height:1.7;}
  .tag-strip{display:flex;gap:7px;margin-top:10px;flex-wrap:wrap;}
  .tag{font-family:'Space Mono',monospace;font-size:10px;padding:2px 9px;border-radius:20px;border:1px solid;}
  .tag.blue{color:var(--blue);border-color:rgba(88,166,255,.3);background:rgba(88,166,255,.07);}
  .tag.green{color:var(--green);border-color:rgba(63,185,80,.3);background:rgba(63,185,80,.07);}
  .tag.amber{color:var(--accent);border-color:rgba(240,165,0,.3);background:rgba(240,165,0,.07);}

  /* FINAL */
  .final-card{background:linear-gradient(135deg,rgba(240,165,0,.12),rgba(63,185,80,.08));border:1px solid rgba(240,165,0,.35);border-radius:12px;padding:30px;text-align:center;margin-top:36px;display:none;}
  .final-card h2{font-family:'Space Mono',monospace;font-size:22px;color:var(--accent);margin:12px 0 6px;}
  .final-card p{color:var(--muted);}

  ::-webkit-scrollbar{width:5px;height:5px;}
  ::-webkit-scrollbar-track{background:var(--bg);}
  ::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}
</style>
</head>
<body>

<header class="header">
  <div class="header-left">
    <div class="jigsaw-icon">ğŸ§©</div>
    <div>
      <h1>Jedburgh Jigsaw Competition â€” Q10 Simulator</h1>
      <p>AH Computing Science 2025 Â· Side-by-side model answer comparison</p>
    </div>
  </div>
  <div class="score-bar">
    <span class="score-label">MARKS</span>
    <span class="score-value" id="scoreDisplay">0/14</span>
    <div class="score-track"><div class="score-fill" id="scoreFill" style="width:0%"></div></div>
  </div>
</header>

<div class="container">

  <div class="intro">
    <div class="intro-icon">ğŸ“‹</div>
    <div>
      <h2>Question 10 â€” Jedburgh Jigsaw Competition Website</h2>
      <p>Write your answers in the <strong>Your Answer</strong> pane. Click <strong>Submit &amp; Compare</strong> to reveal the model answer side-by-side. Use <strong>â–¶ Run</strong> buttons to simulate what your code would produce.</p>
      <div class="tag-strip">
        <span class="tag blue">PHP</span><span class="tag blue">SQL</span>
        <span class="tag green">Sessions</span><span class="tag amber">14 marks total</span>
      </div>
    </div>
  </div>

  <!-- â•â•â• PART A â•â•â• -->
  <div class="section-banner">
    <h2>Part (a) â€” Registration &amp; Sessions</h2>
    <p>signup.html â†’ confirmation.php â†’ saveDetails.php</p>
  </div>

  <!-- 10(a)(i) -->
  <div class="q-card open" id="q-ai">
    <div class="q-header" onclick="toggle('q-ai')">
      <span class="q-tag">10(a)(i)</span>
      <span class="q-title">Explain how sessions and session variables would be used in this situation</span>
      <span class="q-marks">3 marks</span>
      <span class="q-status" id="st-ai">â—‹</span>
      <span class="q-chevron">â–¼</span>
    </div>
    <div class="q-body">
      <div class="context">
        <strong>Situation:</strong> A competitor fills in their name and email on <code>signup.html</code>. This submits to <code>confirmation.php</code>, which greets them by name and shows their email. Clicking confirm activates <code>saveDetails.php</code> which saves their details to the database. HTTP is stateless â€” data is not automatically available between pages.
      </div>
      <div class="wireframe">
        <div class="wf-label">confirmation.php â€” wireframe</div>
        <div class="wf-box">
          <div style="font-weight:700;text-align:center;margin-bottom:10px;">Jedburgh Jigsaw Competition</div>
          <p><span class="wf-hl">babJones@mymail.com</span> thanks for your enquiry</p>
          <p style="margin-top:8px;">Dear <span class="wf-hl">Barbara</span></p>
          <p style="margin-top:8px;">You are registering for the 2025 Jedburgh Jigsaw Competition.</p>
          <p style="margin-top:8px;">Please click below to confirm your registration.</p>
          <div class="wf-btn">click to confirm registration</div>
        </div>
      </div>

      <div class="compare-grid">
        <div class="compare-pane">
          <div class="pane-label student"><div class="pane-dot" style="background:var(--muted)"></div>Your Answer</div>
          <textarea class="text-editor" id="ans-ai" rows="7" placeholder="Explain session_start(), how $_SESSION variables store form data, and how they are used across all three pages..."></textarea>
        </div>
        <div class="compare-pane" id="model-ai-pane" style="display:none">
          <div class="pane-label model"><div class="pane-dot" style="background:var(--green)"></div>Model Answer</div>
          <div class="model-pane prose" id="model-ai-text"></div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-submit" onclick="submitAi()">Submit &amp; Compare</button>
        <button class="hint-btn" onclick="toggleHint('h-ai')">ğŸ’¡ hint</button>
        <div id="badge-ai"></div>
      </div>
      <div class="hint-box" id="h-ai">Three marks = three pages. Cover each: <code>signup.html</code> posts data, <code>confirmation.php</code> starts the session and stores variables, <code>saveDetails.php</code> reads them to insert into the database.</div>
    </div>
  </div>

  <!-- 10(a)(ii) -->
  <div class="q-card" id="q-aii">
    <div class="q-header" onclick="toggle('q-aii')">
      <span class="q-tag">10(a)(ii)</span>
      <span class="q-title">Write PHP code to connect to the database and assign to <code style="font-size:12px;">$link</code></span>
      <span class="q-marks">2 marks</span>
      <span class="q-status" id="st-aii">â—‹</span>
      <span class="q-chevron">â–¼</span>
    </div>
    <div class="q-body">
      <div class="context">
        Use these details: &nbsp;
        <code>database: jigsawFixture</code> &nbsp; <code>password: pass1234</code> &nbsp; <code>server: jigsaw1</code> &nbsp; <code>user: admin</code>
      </div>

      <p style="font-size:12px;color:var(--muted);margin-bottom:10px;">Fill in the connection fields, then write the PHP statement below:</p>
      <div class="input-row">
        <div class="input-group"><label>server</label><input type="text" id="db-server" placeholder="server name" oninput="liveDbCheck()"></div>
        <div class="input-group"><label>user</label><input type="text" id="db-user" placeholder="username" oninput="liveDbCheck()"></div>
        <div class="input-group"><label>password</label><input type="text" id="db-pass" placeholder="password" oninput="liveDbCheck()"></div>
        <div class="input-group"><label>database</label><input type="text" id="db-name" placeholder="database name" oninput="liveDbCheck()"></div>
      </div>

      <div class="compare-grid">
        <div class="compare-pane">
          <div class="pane-label student"><div class="pane-dot" style="background:var(--muted)"></div>Your PHP Code</div>
          <textarea class="code-editor" id="ans-aii" rows="3" placeholder="$link = mysqli_connect(...);"></textarea>
        </div>
        <div class="compare-pane" id="model-aii-pane" style="display:none">
          <div class="pane-label model"><div class="pane-dot" style="background:var(--green)"></div>Model Answer</div>
          <div class="model-pane" id="model-aii-text"></div>
        </div>
      </div>

      <div class="db-panel" id="db-sim">
        <div id="db-status" style="color:var(--muted)">â¬¤ &nbsp;Fill in the fields above and click â–¶ Run Connection to test...</div>
        <div id="db-detail"></div>
      </div>

      <div class="btn-row">
        <button class="btn btn-run" onclick="runDb()">â–¶ Run Connection</button>
        <button class="btn btn-submit" onclick="submitAii()">Submit &amp; Compare</button>
        <button class="hint-btn" onclick="toggleHint('h-aii')">ğŸ’¡ hint</button>
        <div id="badge-aii"></div>
      </div>
      <div class="hint-box" id="h-aii">Use <code>mysqli_connect(server, user, password, database)</code> â€” four arguments in that exact order. Assign to <code>$link</code>.</div>
    </div>
  </div>

  <!-- â•â•â• PART B â•â•â• -->
  <div class="section-banner">
    <h2>Part (b) â€” Processing Round 1 Results</h2>
    <p>Points awarded by finishing position. Loop processes up to 24 competitors.</p>
  </div>

  <!-- 10(b)(i) -->
  <div class="q-card" id="q-bi">
    <div class="q-header" onclick="toggle('q-bi')">
      <span class="q-tag">10(b)(i)</span>
      <span class="q-title">Explain the significance of the SQL query at line 37</span>
      <span class="q-marks">1 mark</span>
      <span class="q-status" id="st-bi">â—‹</span>
      <span class="q-chevron">â–¼</span>
    </div>
    <div class="q-body">
      <div class="code-block"><span class="kw">Line 37</span>  $query = <span class="str">"SELECT competitorID, forename, surname,
          timeTakenRound1 FROM Competitor ORDER BY
          timeTakenRound1 ASC"</span>;</div>

      <div class="compare-grid">
        <div class="compare-pane">
          <div class="pane-label student"><div class="pane-dot" style="background:var(--muted)"></div>Your Answer</div>
          <textarea class="text-editor" id="ans-bi" rows="4" placeholder="Explain why this specific query is important to the points allocation process..."></textarea>
        </div>
        <div class="compare-pane" id="model-bi-pane" style="display:none">
          <div class="pane-label model"><div class="pane-dot" style="background:var(--green)"></div>Model Answer</div>
          <div class="model-pane prose" id="model-bi-text"></div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-submit" onclick="submitBi()">Submit &amp; Compare</button>
        <button class="hint-btn" onclick="toggleHint('h-bi')">ğŸ’¡ hint</button>
        <div id="badge-bi"></div>
      </div>
      <div class="hint-box" id="h-bi">Focus on <code>ORDER BY timeTakenRound1 ASC</code>. What does ascending order mean for a time value? Why does the processing order of results matter for awarding points?</div>
    </div>
  </div>

  <!-- 10(b)(ii) -->
  <div class="q-card" id="q-bii">
    <div class="q-header" onclick="toggle('q-bii')">
      <span class="q-tag">10(b)(ii)</span>
      <span class="q-title">Explain how the complex condition at line 48 controls the while loop</span>
      <span class="q-marks">2 marks</span>
      <span class="q-status" id="st-bii">â—‹</span>
      <span class="q-chevron">â–¼</span>
    </div>
    <div class="q-body">
      <div class="code-block"><span class="kw">Line 48</span>  <span class="kw">while</span> (($row = <span class="fn">mysqli_fetch_array</span>($round1)) <span class="kw">and</span>
          $numProcessed &lt; 24)</div>

      <p style="font-size:12px;color:var(--muted);margin:12px 0 8px;">Explain <strong>both</strong> conditions â€” one mark each:</p>

      <div style="margin-bottom:14px;">
        <p style="font-size:12px;color:var(--blue);margin-bottom:6px;font-family:'Space Mono',monospace;">Condition 1: ($row = mysqli_fetch_array($round1))</p>
        <textarea class="text-editor" id="ans-bii-1" rows="3" placeholder="What does this do? When does it become false?"></textarea>
      </div>
      <div>
        <p style="font-size:12px;color:var(--blue);margin-bottom:6px;font-family:'Space Mono',monospace;">Condition 2: $numProcessed &lt; 24</p>
        <textarea class="text-editor" id="ans-bii-2" rows="3" placeholder="Why specifically 24? What competitors does this cover?"></textarea>
      </div>

      <!-- Model answers shown as two-column when revealed -->
      <div id="model-bii-wrap" style="display:none; margin-top:16px;">
        <div class="compare-grid">
          <div class="compare-pane">
            <div class="pane-label model"><div class="pane-dot" style="background:var(--green)"></div>Model â€” Condition 1</div>
            <div class="model-pane prose" id="model-bii-1" style="border-radius:0 0 var(--radius) var(--radius);"></div>
          </div>
          <div class="compare-pane">
            <div class="pane-label model"><div class="pane-dot" style="background:var(--green)"></div>Model â€” Condition 2</div>
            <div class="model-pane prose" id="model-bii-2" style="border-radius:0 0 var(--radius) var(--radius);"></div>
          </div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-submit" onclick="submitBii()">Submit &amp; Compare</button>
        <button class="hint-btn" onclick="toggleHint('h-bii')">ğŸ’¡ hint</button>
        <div id="badge-bii"></div>
      </div>
      <div class="hint-box" id="h-bii">Points total: 1Ã—8 + 1Ã—5 + 1Ã—3 + 21Ã—1 = <strong>24 competitors</strong>. After 24, no points are awarded so processing can stop regardless of remaining rows.</div>
    </div>
  </div>

  <!-- 10(b)(iii) -->
  <div class="q-card" id="q-biii">
    <div class="q-header" onclick="toggle('q-biii')">
      <span class="q-tag">10(b)(iii)</span>
      <span class="q-title">Design pseudocode to allocate points â€” update variable <code style="font-size:12px;">$points</code></span>
      <span class="q-marks">2 marks</span>
      <span class="q-status" id="st-biii">â—‹</span>
      <span class="q-chevron">â–¼</span>
    </div>
    <div class="q-body">
      <div class="context">
        1st â†’ <strong style="color:var(--accent)">8 pts</strong> &nbsp;Â·&nbsp;
        2nd â†’ <strong style="color:#c2a500">5 pts</strong> &nbsp;Â·&nbsp;
        3rd â†’ <strong style="color:var(--blue)">3 pts</strong> &nbsp;Â·&nbsp;
        4thâ€“24th â†’ <strong style="color:var(--muted)">1 pt</strong><br>
        <code>$numProcessed</code> is 0-indexed (0 = 1st place). Set the variable <code>$points</code>.
      </div>

      <div class="compare-grid">
        <div class="compare-pane">
          <div class="pane-label student"><div class="pane-dot" style="background:var(--muted)"></div>Your Pseudocode</div>
          <textarea class="code-editor" id="ans-biii" rows="10" placeholder="IF $numProcessed = 0 THEN&#10;    SET $points TO ...&#10;ELSE IF ...&#10;END IF"></textarea>
        </div>
        <div class="compare-pane" id="model-biii-pane" style="display:none">
          <div class="pane-label model"><div class="pane-dot" style="background:var(--green)"></div>Model Answer</div>
          <div class="model-pane" id="model-biii-text"></div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-run" onclick="runPointsSim()">â–¶ Simulate Output</button>
        <button class="btn btn-submit" onclick="submitBiii()">Submit &amp; Compare</button>
        <button class="hint-btn" onclick="toggleHint('h-biii')">ğŸ’¡ hint</button>
        <div id="badge-biii"></div>
      </div>
      <div class="hint-box" id="h-biii">You need IF / ELSE IF / ELSE covering all four cases. <code>$numProcessed = 0</code> is 1st, <code>= 1</code> is 2nd, <code>= 2</code> is 3rd, the final ELSE catches positions 4â€“24.</div>

      <div class="sim-panel" id="pts-sim" style="display:none; margin-top:14px;">
        <div class="sim-header"><div class="sim-dot red"></div><div class="sim-dot yellow"></div><div class="sim-dot green"></div><span class="sim-title">Points Allocation â€” Live Simulation (your pseudocode vs correct)</span></div>
        <div class="sim-body" id="pts-sim-body" style="padding:0;"></div>
      </div>
    </div>
  </div>

  <!-- 10(b)(iv) -->
  <div class="q-card" id="q-biv">
    <div class="q-header" onclick="toggle('q-biv')">
      <span class="q-tag">10(b)(iv)</span>
      <span class="q-title">Write PHP at line 63 to display one competitor row in the HTML table</span>
      <span class="q-marks">2 marks</span>
      <span class="q-status" id="st-biv">â—‹</span>
      <span class="q-chevron">â–¼</span>
    </div>
    <div class="q-body">
      <div class="context">
        <code>$row</code> keys: <code>forename</code>, <code>surname</code>, <code>timeTakenRound1</code>, <code>competitorID</code><br>
        <code>$points</code> holds the allocated points for this competitor.<br>
        Output one <code>&lt;tr&gt;</code> with three <code>&lt;td&gt;</code> cells: full name, time taken, points.
      </div>

      <p style="font-size:12px;color:var(--muted);margin-bottom:8px;">Target output (always visible for reference):</p>
      <div class="sim-panel" style="margin-bottom:18px;">
        <div class="sim-header"><div class="sim-dot red"></div><div class="sim-dot yellow"></div><div class="sim-dot green"></div><span class="sim-title">Round 1 Results â€” expected table</span></div>
        <div class="sim-body" style="padding:0;">
          <table class="sim-table">
            <thead><tr><th>Competitor</th><th>Time Taken</th><th>Points</th></tr></thead>
            <tbody>
              <tr><td>Barbara Jones</td><td>02:32:24</td><td class="pts-8">8</td></tr>
              <tr><td>Olive Oil</td><td>02:38:38</td><td class="pts-5">5</td></tr>
              <tr><td>David Defau</td><td>02:39:58</td><td class="pts-3">3</td></tr>
              <tr><td>Andy Peters</td><td>02:40:30</td><td class="pts-1">1</td></tr>
              <tr><td>Lin Cadiz</td><td>02:41:19</td><td class="pts-1">1</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="compare-grid">
        <div class="compare-pane">
          <div class="pane-label student"><div class="pane-dot" style="background:var(--muted)"></div>Your PHP â€” Line 63</div>
          <textarea class="code-editor" id="ans-biv" rows="4" placeholder='echo "&lt;tr&gt;...";'></textarea>
        </div>
        <div class="compare-pane" id="model-biv-pane" style="display:none">
          <div class="pane-label model"><div class="pane-dot" style="background:var(--green)"></div>Model Answer</div>
          <div class="model-pane" id="model-biv-text"></div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-run" onclick="runTableSim()">â–¶ Preview My Output</button>
        <button class="btn btn-submit" onclick="submitBiv()">Submit &amp; Compare</button>
        <button class="hint-btn" onclick="toggleHint('h-biv')">ğŸ’¡ hint</button>
        <div id="badge-biv"></div>
      </div>
      <div class="hint-box" id="h-biv">Concatenate <code>$row['forename'] . " " . $row['surname']</code> for the name cell. You need three separate <code>&lt;td&gt;</code> tags â€” name, time, points.</div>

      <div class="sim-panel" id="table-sim" style="display:none; margin-top:14px;">
        <div class="sim-header"><div class="sim-dot red"></div><div class="sim-dot yellow"></div><div class="sim-dot green"></div><span class="sim-title">Your Code â€” Rendered (Barbara Jones, $points=8)</span></div>
        <div class="sim-body" id="table-sim-body" style="padding:0;"></div>
      </div>
    </div>
  </div>

  <!-- 10(b)(v) -->
  <div class="q-card" id="q-bv">
    <div class="q-header" onclick="toggle('q-bv')">
      <span class="q-tag">10(b)(v)</span>
      <span class="q-title">Write the SQL UPDATE statement at line 65</span>
      <span class="q-marks">1 mark</span>
      <span class="q-status" id="st-bv">â—‹</span>
      <span class="q-chevron">â–¼</span>
    </div>
    <div class="q-body">
      <div class="context">
        Incomplete code at line 65:<br><br>
        <code>mysqli_query($link, "<span style="color:var(--accent)">___________________</span> WHERE competitorID = '$row[competitorID]'");</code><br><br>
        Write the missing SQL to update <code>competitorPoints</code> with the value of <code>$points</code>.
      </div>

      <div class="compare-grid">
        <div class="compare-pane">
          <div class="pane-label student"><div class="pane-dot" style="background:var(--muted)"></div>Your SQL (the part before WHERE)</div>
          <textarea class="code-editor" id="ans-bv" rows="3" placeholder="UPDATE Competitor SET ..."></textarea>
        </div>
        <div class="compare-pane" id="model-bv-pane" style="display:none">
          <div class="pane-label model"><div class="pane-dot" style="background:var(--green)"></div>Model Answer</div>
          <div class="model-pane" id="model-bv-text"></div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-run" onclick="runUpdateSim()">â–¶ Simulate Query</button>
        <button class="btn btn-submit" onclick="submitBv()">Submit &amp; Compare</button>
        <button class="hint-btn" onclick="toggleHint('h-bv')">ğŸ’¡ hint</button>
        <div id="badge-bv"></div>
      </div>
      <div class="hint-box" id="h-bv"><code>UPDATE tableName SET fieldName = '$variable'</code> â€” the WHERE clause is already in the question, so you only need the UPDATEâ€¦SET part.</div>

      <div class="sim-panel" id="update-sim" style="display:none; margin-top:14px;">
        <div class="sim-header"><div class="sim-dot red"></div><div class="sim-dot yellow"></div><div class="sim-dot green"></div><span class="sim-title">Database Update â€” Simulation</span></div>
        <div class="sim-body" id="update-sim-body"></div>
      </div>
    </div>
  </div>

  <!-- FINAL -->
  <div class="final-card" id="final-card">
    <div style="font-size:44px;">ğŸ†</div>
    <h2>All Parts Submitted!</h2>
    <p style="margin-top:6px;">Your final score: <strong id="final-score" style="color:var(--text);font-size:18px;"></strong></p>
    <p style="margin-top:8px;font-size:13px;">Review the model answers above to see how your responses compare.</p>
    <button class="btn btn-reset" onclick="resetAll()" style="margin-top:16px;">â†º Reset &amp; Try Again</button>
  </div>

</div>

<script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CORRECT = { server:'jigsaw1', user:'admin', pass:'pass1234', db:'jigsawFixture' };
const competitors = [
  {id:1,forename:'Barbara',surname:'Jones',    time:'02:32:24'},
  {id:2,forename:'Olive',  surname:'Oil',      time:'02:38:38'},
  {id:3,forename:'David',  surname:'Defau',    time:'02:39:58'},
  {id:4,forename:'Andy',   surname:'Peters',   time:'02:40:30'},
  {id:5,forename:'Lin',    surname:'Cadiz',    time:'02:41:19'},
  {id:6,forename:'Sarah',  surname:'McKenzie', time:'02:43:05'},
  {id:7,forename:'Tom',    surname:'Brannigan',time:'02:44:12'},
];

// â”€â”€ MODEL ANSWERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MODELS = {
  ai:
`session_start() is called at the top of confirmation.php.

Session variables are created from the form data submitted by signup.html:
  $_SESSION['forename'] = $_POST['forename'];
  $_SESSION['email']    = $_POST['email'];

These are read on confirmation.php to display:
  "Dear Barbara"  â†’  uses $_SESSION['forename']
  "babJones@mymail.com thanks..."  â†’  uses $_SESSION['email']

When the user clicks Confirm, saveDetails.php is loaded.
session_start() is called again to resume the existing session.
The session variables are read and used to INSERT the competitor's
details into the Competitor table in the database.`,

  aii: `$link = mysqli_connect("jigsaw1", "admin", "pass1234", "jigsawFixture");`,

  bi:
`The query sorts competitors by timeTakenRound1 in ascending (ASC) order,
so the competitor with the fastest (smallest) time appears first.

This is significant because as the while loop processes each row,
$numProcessed = 0 corresponds to the winner, $numProcessed = 1 to
second place, etc. â€” allowing the correct points (8, 5, 3, 1) to be
allocated based on finishing position.`,

  bii1:
`mysqli_fetch_array($round1) fetches the next row from the result
set and assigns it to $row. The loop continues while there are
rows still to fetch. When no more rows exist it returns false,
ending the loop.`,

  bii2:
`$numProcessed < 24 limits processing to the top 24 competitors,
since only 24 receive points:
  1st (8pts) + 2nd (5pts) + 3rd (3pts) + 4thâ€“24th (1pt each)
  = 1 + 1 + 1 + 21 = 24 total.
Remaining competitors score 0 so need not be processed.`,

  biii:
`IF $numProcessed = 0 THEN
    SET $points TO 8
ELSE IF $numProcessed = 1 THEN
    SET $points TO 5
ELSE IF $numProcessed = 2 THEN
    SET $points TO 3
ELSE
    SET $points TO 1
END IF`,

  biv: `echo "<tr><td>" . $row['forename'] . " " . $row['surname'] . "</td><td>" . $row['timeTakenRound1'] . "</td><td>" . $points . "</td></tr>";`,

  bv: `UPDATE Competitor SET competitorPoints = '$points'`
};

// â”€â”€ MARKS STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const maxM = {ai:3,aii:2,bi:1,bii:2,biii:2,biv:2,bv:1};
const marks = {ai:null,aii:null,bi:null,bii:null,biii:null,biv:null,bv:null};

// â”€â”€ UTILITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggle(id){ document.getElementById(id).classList.toggle('open'); }
function toggleHint(id){ document.getElementById(id).classList.toggle('show'); }
function esc(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function showModel(paneId, textId, content, prose){
  const pane = document.getElementById(paneId);
  pane.style.display = 'block';
  const el = document.getElementById(textId);
  if(prose) el.classList.add('prose');
  el.textContent = content;
}

function setBadge(q, score){
  marks[q] = score;
  const max = maxM[q];
  const el = document.getElementById('badge-'+q);
  const card = document.getElementById('q-'+q);
  const st = document.getElementById('st-'+q);
  if(score===max){
    el.innerHTML = `<span class="mark-badge full">âœ“ ${score}/${max}</span>`;
    card.classList.add('answered'); st.textContent='âœ…';
  } else if(score>0){
    el.innerHTML = `<span class="mark-badge partial">â—‘ ${score}/${max}</span>`;
    card.classList.add('answered'); st.textContent='âš ï¸';
  } else {
    el.innerHTML = `<span class="mark-badge zero">âœ— ${score}/${max}</span>`;
    st.textContent='âŒ';
  }
  updateTotalScore();
}

function updateTotalScore(){
  let t=0;
  Object.entries(marks).forEach(([k,v])=>{ if(v!==null) t+=v; });
  document.getElementById('scoreDisplay').textContent = t+'/14';
  document.getElementById('scoreFill').style.width = (t/14*100)+'%';
  if(Object.values(marks).every(v=>v!==null)){
    const fc = document.getElementById('final-card');
    fc.style.display='block';
    document.getElementById('final-score').textContent = t+' / 14 marks';
    setTimeout(()=>fc.scrollIntoView({behavior:'smooth',block:'center'}),200);
  }
}

// â”€â”€ SUBMIT FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function submitAi(){
  const a = document.getElementById('ans-ai').value.toLowerCase();
  const c1 = /session_start/.test(a);
  const c2 = /\$_session|session\[|session variable/.test(a);
  const c3 = /savedetails|save.*detail|insert|database/.test(a);
  showModel('model-ai-pane','model-ai-text', MODELS.ai, true);
  setBadge('ai', (c1?1:0)+(c2?1:0)+(c3?1:0));
}

function submitAii(){
  const code = document.getElementById('ans-aii').value;
  const s=document.getElementById('db-server').value.trim();
  const u=document.getElementById('db-user').value.trim();
  const p=document.getElementById('db-pass').value.trim();
  const d=document.getElementById('db-name').value.trim();
  const allFields = s===CORRECT.server&&u===CORRECT.user&&p===CORRECT.pass&&d===CORRECT.db;
  const hasLink = /\$link\s*=\s*mysqli_connect/.test(code);
  const hasAllInCode = /jigsaw1/.test(code)&&/admin/.test(code)&&/pass1234/.test(code)&&/jigsawFixture/.test(code);
  const score = (hasLink&&(allFields||hasAllInCode)) ? 2 : (hasLink||allFields) ? 1 : 0;
  showModel('model-aii-pane','model-aii-text', MODELS.aii);
  setBadge('aii', score);
}

function submitBi(){
  const a = document.getElementById('ans-bi').value.toLowerCase();
  const hasOrder = /order|sort|asc|ascending/.test(a);
  const hasFastest = /fast|short|small|low|first|top|best|quick/.test(a);
  const hasPoints = /point|award|position|rank/.test(a);
  showModel('model-bi-pane','model-bi-text', MODELS.bi, true);
  setBadge('bi', (hasOrder&&(hasFastest||hasPoints)) ? 1 : 0);
}

function submitBii(){
  const a1 = document.getElementById('ans-bii-1').value.toLowerCase();
  const a2 = document.getElementById('ans-bii-2').value.toLowerCase();
  const c1 = /fetch|row|next|null|no more|end|result|false/.test(a1);
  const c2 = /24|top|first|point|award|position/.test(a2);
  document.getElementById('model-bii-wrap').style.display='block';
  document.getElementById('model-bii-1').textContent = MODELS.bii1;
  document.getElementById('model-bii-2').textContent = MODELS.bii2;
  document.getElementById('model-bii-1').classList.add('prose');
  document.getElementById('model-bii-2').classList.add('prose');
  setBadge('bii', (c1?1:0)+(c2?1:0));
}

function submitBiii(){
  const a = document.getElementById('ans-biii').value.toLowerCase();
  const has8   = /=\s*0[\s\S]{0,40}8/.test(a);
  const has5   = /=\s*1[\s\S]{0,40}5/.test(a);
  const has3   = /=\s*2[\s\S]{0,40}3/.test(a);
  const has1   = /else[\s\S]{0,30}1/.test(a);
  const hasIf  = /if/.test(a);
  const score  = (hasIf&&has8&&has5&&has3&&has1) ? 2 : (hasIf&&has8) ? 1 : 0;
  showModel('model-biii-pane','model-biii-text', MODELS.biii);
  setBadge('biii', score);
}

function submitBiv(){
  const a = document.getElementById('ans-biv').value;
  const ok = /echo/.test(a) && /<tr>/.test(a) && /<td>/.test(a) &&
             /forename/.test(a) && /surname/.test(a) &&
             /timetakenround1/i.test(a) && /\$points/.test(a);
  const partial = /echo/.test(a) && (/forename/.test(a)||/surname/.test(a));
  showModel('model-biv-pane','model-biv-text', MODELS.biv);
  setBadge('biv', ok?2:partial?1:0);
}

function submitBv(){
  const a = document.getElementById('ans-bv').value.trim().toLowerCase();
  const ok = /update\s+competitor\s+set\s+competitorpoints\s*=\s*['"]?\$points['"]?/.test(a);
  showModel('model-bv-pane','model-bv-text', MODELS.bv);
  setBadge('bv', ok?1:0);
}

// â”€â”€ LIVE DB FIELD COLOURING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function liveDbCheck(){
  const map={'db-server':'server','db-user':'user','db-pass':'pass','db-name':'db'};
  Object.entries(map).forEach(([id,key])=>{
    const el=document.getElementById(id);
    el.className = el.value==='' ? '' : el.value===CORRECT[key] ? 'ok' : 'bad';
  });
}

// â”€â”€ RUN: DB CONNECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function runDb(){
  const s=document.getElementById('db-server').value.trim();
  const u=document.getElementById('db-user').value.trim();
  const p=document.getElementById('db-pass').value.trim();
  const d=document.getElementById('db-name').value.trim();
  const code=document.getElementById('ans-aii').value;
  const statusEl=document.getElementById('db-status');
  const detailEl=document.getElementById('db-detail');
  statusEl.innerHTML='â¬¤ &nbsp;<span class="db-connecting">Connecting to '+esc(s||'?')+'...</span>';
  detailEl.innerHTML='';
  setTimeout(()=>{
    const allOk = s===CORRECT.server&&u===CORRECT.user&&p===CORRECT.pass&&d===CORRECT.db;
    const hasLink=/\$link\s*=\s*mysqli_connect/.test(code);
    const hasAll=/jigsaw1/.test(code)&&/admin/.test(code)&&/pass1234/.test(code)&&/jigsawFixture/.test(code);
    if((allOk||hasAll)&&hasLink){
      statusEl.innerHTML='â¬¤ &nbsp;<span class="db-connected">Connected successfully âœ“</span>';
      detailEl.innerHTML=`<div class="db-row"><span>Host:</span><span class="ok">jigsaw1</span></div>
<div class="db-row"><span>User:</span><span class="ok">admin</span></div>
<div class="db-row"><span>Database:</span><span class="ok">jigsawFixture</span></div>
<div class="db-row"><span>$link:</span><span class="ok">mysqli object</span></div>`;
    } else {
      statusEl.innerHTML='â¬¤ &nbsp;<span class="db-failed">Connection failed âœ—</span>';
      const errs=[];
      if(!hasLink) errs.push('$link not assigned via mysqli_connect()');
      if(s!==CORRECT.server) errs.push('server: got "'+esc(s||'?')+'" â€” expected "jigsaw1"');
      if(u!==CORRECT.user)   errs.push('user: got "'+esc(u||'?')+'" â€” expected "admin"');
      if(p!==CORRECT.pass)   errs.push('password: got "'+esc(p||'?')+'" â€” expected "pass1234"');
      if(d!==CORRECT.db)     errs.push('database: got "'+esc(d||'?')+'" â€” expected "jigsawFixture"');
      detailEl.innerHTML=errs.map(e=>`<div class="db-row"><span class="bad">âœ— ${e}</span></div>`).join('');
    }
  },700);
}

// â”€â”€ RUN: POINTS SIMULATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function runPointsSim(){
  const a = document.getElementById('ans-biii').value.toLowerCase();
  const panel=document.getElementById('pts-sim');
  const body=document.getElementById('pts-sim-body');
  panel.style.display='block';

  function detect(i){
    if(i===0) return /=\s*0[\s\S]{0,50}8/.test(a)?8:null;
    if(i===1) return /=\s*1[\s\S]{0,50}5/.test(a)?5:null;
    if(i===2) return /=\s*2[\s\S]{0,50}3/.test(a)?3:null;
    return /else[\s\S]{0,30}1/.test(a)?1:null;
  }

  const rows = competitors.map((c,i)=>{
    const sp = detect(i>2?3:i);
    const correct = i===0?8:i===1?5:i===2?3:1;
    const ptsCls = correct===8?'pts-8':correct===5?'pts-5':correct===3?'pts-3':'pts-1';
    const yourCell = sp!==null
      ? `<td class="${sp===correct?ptsCls:'bad'}">${sp}</td><td style="font-size:11px;color:${sp===correct?'var(--green)':'var(--red)'};">${sp===correct?'âœ“':'should be '+correct}</td>`
      : `<td class="bad">?</td><td style="font-size:11px;color:var(--muted);">not detected</td>`;
    return `<tr><td>${c.forename} ${c.surname}</td><td>${i}</td><td class="${ptsCls}">${correct}</td>${yourCell}</tr>`;
  });

  body.innerHTML=`<table class="sim-table">
    <thead><tr><th>Competitor</th><th>$numProcessed</th><th>Correct pts</th><th>Your pts</th><th>Check</th></tr></thead>
    <tbody>${rows.join('')}</tbody>
  </table>`;
}

// â”€â”€ RUN: TABLE SIMULATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function runTableSim(){
  const a = document.getElementById('ans-biv').value;
  const panel=document.getElementById('table-sim');
  const body=document.getElementById('table-sim-body');
  panel.style.display='block';

  const hasForename=/forename/.test(a), hasSurname=/surname/.test(a);
  const hasTime=/timetakenround1/i.test(a), hasPoints=/\$points/.test(a);
  const hasTr=/<tr>/.test(a), hasTd=/<td>/.test(a), hasEcho=/echo/.test(a);

  if(hasTr&&hasTd&&hasForename&&hasSurname&&hasTime&&hasPoints){
    body.innerHTML=`<table class="sim-table">
      <thead><tr><th>Competitor</th><th>Time Taken</th><th>Points</th></tr></thead>
      <tbody>
        <tr><td>Barbara Jones</td><td>02:32:24</td><td class="pts-8">8</td></tr>
        <tr style="opacity:.4"><td colspan="3" style="font-size:11px;color:var(--muted);">...loop would continue generating rows for each competitor</td></tr>
      </tbody>
    </table>
    <p style="padding:10px 12px;font-size:11px;color:var(--green);">âœ“ Your code would produce the correct row structure</p>`;
  } else {
    const miss=[];
    if(!hasTr) miss.push('&lt;tr&gt;');
    if(!hasTd) miss.push('&lt;td&gt;');
    if(!hasForename) miss.push("$row['forename']");
    if(!hasSurname)  miss.push("$row['surname']");
    if(!hasTime)     miss.push("$row['timeTakenRound1']");
    if(!hasPoints)   miss.push('$points');
    body.innerHTML=`<p style="padding:16px;color:var(--red);">âœ— Still missing: ${miss.join(', ')}</p>`;
  }
}

// â”€â”€ RUN: UPDATE SIMULATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function runUpdateSim(){
  const a = document.getElementById('ans-bv').value.trim();
  const panel=document.getElementById('update-sim');
  const body=document.getElementById('update-sim-body');
  panel.style.display='block';

  const hasUpdate=/update/i.test(a), hasTable=/competitor/i.test(a);
  const hasSet=/set/i.test(a), hasField=/competitorpoints/i.test(a);
  const hasVar=/\$points/.test(a);

  if(hasUpdate&&hasTable&&hasSet&&hasField&&hasVar){
    const full=esc(a)+' WHERE competitorID = \'1\'';
    body.innerHTML=`<p class="ok">âœ“ Valid UPDATE structure</p>
<br><p style="color:var(--muted);margin-bottom:6px;">Full query (with WHERE from line 65):</p>
<p style="color:var(--blue);">${full}</p>
<br><p class="ok">âœ“ 1 row affected â€” Barbara Jones: competitorPoints updated to 8</p>`;
  } else {
    const miss=[];
    if(!hasUpdate) miss.push('UPDATE keyword');
    if(!hasTable)  miss.push('table name (Competitor)');
    if(!hasSet)    miss.push('SET keyword');
    if(!hasField)  miss.push('competitorPoints');
    if(!hasVar)    miss.push('$points variable');
    body.innerHTML=`<p class="bad">âœ— Missing: ${miss.join(', ')}</p>`;
  }
}

// â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetAll(){
  const textIds=['ans-ai','ans-aii','ans-bi','ans-bii-1','ans-bii-2','ans-biii','ans-biv','ans-bv'];
  textIds.forEach(id=>{ const e=document.getElementById(id); if(e) e.value=''; });
  ['db-server','db-user','db-pass','db-name'].forEach(id=>{ const e=document.getElementById(id); if(e){e.value='';e.className='';} });
  Object.keys(marks).forEach(k=>{
    marks[k]=null;
    const b=document.getElementById('badge-'+k); if(b) b.innerHTML='';
    const c=document.getElementById('q-'+k); if(c) c.classList.remove('answered');
    const s=document.getElementById('st-'+k); if(s) s.textContent='â—‹';
  });
  ['model-ai-pane','model-aii-pane','model-bi-pane','model-biii-pane','model-biv-pane','model-bv-pane']
    .forEach(id=>{ const e=document.getElementById(id); if(e) e.style.display='none'; });
  document.getElementById('model-bii-wrap').style.display='none';
  ['pts-sim','table-sim','update-sim'].forEach(id=>{ const e=document.getElementById(id); if(e) e.style.display='none'; });
  document.getElementById('db-status').innerHTML='â¬¤ &nbsp;<span style="color:var(--muted)">Fill in the fields above and click â–¶ Run Connection to test...</span>';
  document.getElementById('db-detail').innerHTML='';
  document.getElementById('final-card').style.display='none';
  document.getElementById('scoreDisplay').textContent='0/14';
  document.getElementById('scoreFill').style.width='0%';
}

// Tab key support in all textareas
document.querySelectorAll('textarea').forEach(ta=>{
  ta.addEventListener('keydown',e=>{
    if(e.key==='Tab'){
      e.preventDefault();
      const s=ta.selectionStart;
      ta.value=ta.value.substring(0,s)+'  '+ta.value.substring(ta.selectionEnd);
      ta.selectionStart=ta.selectionEnd=s+2;
    }
  });
});
</script>
</body>
</html>